<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COLECCIONA Y GANA</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg1: #F0F8FF; --bg2: #E6F3FF; --accent: #4A90E2; --accent2: #7B68EE;
            --card: #ffffffaa; --text: #333; --success: #4CAF50; --warning: #FF9800;
            --error: #f44336; --info: #2196F3; --candy-pink: #FF69B4; --candy-yellow: #FFD700;
            --candy-green: #32CD32; --candy-purple: #9370DB;
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body {
            font-family: 'Montserrat', Arial, sans-serif; 
            background: linear-gradient(135deg, var(--bg1), var(--bg2));
            color: var(--text); 
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }
        
        .candy-bg {
            position: fixed;
            z-index: -1;
            opacity: 0.1;
            pointer-events: none;
        }
        
        .candy-1 {
            top: 10%;
            left: 5%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--candy-pink), transparent);
            border-radius: 50%;
            filter: blur(5px);
        }
        
        .candy-2 {
            top: 70%;
            right: 10%;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--candy-yellow), transparent);
            border-radius: 50%;
            filter: blur(5px);
        }
        
        .candy-3 {
            bottom: 20%;
            left: 15%;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, var(--candy-green), transparent);
            border-radius: 50%;
            filter: blur(5px);
        }
        
        .candy-4 {
            top: 30%;
            right: 20%;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, var(--candy-purple), transparent);
            border-radius: 50%;
            filter: blur(5px);
        }
        
        header {
            padding: 20px 18px; 
            text-align: center; 
            position: sticky; 
            top: 0; 
            z-index: 30;
            background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            backdrop-filter: blur(4px);
            border-bottom: 1px solid rgba(0,0,0,0.04);
            animation: slideDown 0.8s ease-out;
        }
        
        header h1 { 
            font-family: 'Pacifico', cursive; 
            font-size: 36px; 
            margin: 0; 
            color: var(--accent); 
            text-shadow: 0 6px 18px rgba(74, 144, 226, 0.12); 
        }
        
        header p { 
            margin-top: 6px; 
            font-weight: 700; 
            color: #4A5568; 
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            color: var(--accent);
        }
        
        .nav-tab.active {
            background: var(--accent);
            color: white;
        }
        
        .nav-tab:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .hero {
            display: flex; 
            gap: 20px; 
            align-items: center; 
            justify-content: space-between; 
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .hero-card {
            background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
            border-radius: 18px; 
            padding: 20px; 
            flex: 1; 
            min-width: 260px; 
            box-shadow: 0 18px 40px rgba(0,0,0,0.08);
            display: flex; 
            gap: 15px; 
            align-items: center;
            animation: fadeInUp 0.8s ease-out 0.2s both;
            border-left: 5px solid var(--accent);
        }
        
        .badge { 
            width: 100px; 
            height: 100px; 
            border-radius: 14px; 
            background: linear-gradient(135deg, var(--accent), var(--accent2)); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #fff; 
            font-weight: 900; 
            font-size: 18px; 
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.15);
            animation: pulse 2s infinite;
        }
        
        .hero-text h2 { 
            margin: 0; 
            font-size: 20px; 
            color: #2D3748;
        }
        
        .hero-text p { 
            margin: 8px 0 0; 
            font-size: 14px; 
            color: #4A5568; 
        }
        
        .collections { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-top: 20px; 
        }
        
        .card {
            background: var(--card); 
            padding: 20px; 
            border-radius: 14px; 
            text-align: center; 
            position: relative;
            overflow: hidden; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.06); 
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(30px);
            border: 1px solid rgba(74, 144, 226, 0.1);
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
        }
        
        .card.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        .card:hover { 
            transform: translateY(-8px) scale(1.02); 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .card img { 
            width: 140px; 
            height: 140px; 
            object-fit: cover; 
            border-radius: 12px; 
            margin: 4px auto 12px; 
            border: 4px solid rgba(255,255,255,0.6); 
        }
        
        .card h3 { 
            margin: 10px 0 6px; 
            font-size: 18px; 
            color: #2D3748; 
        }
        
        .card p { 
            margin: 0 0 15px; 
            font-size: 13px; 
            color: #4A5568; 
            line-height: 1.4;
        }
        
        .actions { 
            display: flex; 
            gap: 8px; 
            justify-content: center; 
        }
        
        .btn { 
            background: var(--accent); 
            color: #fff; 
            border: none; 
            padding: 10px 18px; 
            border-radius: 999px; 
            font-weight: 700; 
            cursor: pointer; 
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.12); 
            transition: all 0.3s ease; 
            font-size: 14px;
        }
        
        .btn.secondary { 
            background: #E2E8F0; 
            color: #4A5568; 
            font-weight: 700; 
            box-shadow: none; 
        }
        
        .btn.success {
            background: var(--success);
        }
        
        .btn.warning {
            background: var(--warning);
        }
        
        .btn.info {
            background: var(--info);
        }
        
        .btn.danger {
            background: var(--error);
        }
        
        .btn.help {
            background: var(--candy-pink);
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
        }
        
        .btn:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 12px 25px rgba(74, 144, 226, 0.2);
        }

        .modal-back { 
            position: fixed; 
            inset: 0; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            background: rgba(10,10,10,0.6); 
            z-index: 100; 
            padding: 20px; 
            animation: fadeIn 0.3s ease;
        }
        
        .modal { 
            width: 100%; 
            max-width: 600px; 
            background: #fff; 
            border-radius: 14px; 
            overflow: hidden; 
            box-shadow: 0 40px 80px rgba(0,0,0,0.35); 
            animation: scaleIn 0.4s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-content {
            padding: 30px;
        }
        
        .form-container {
            width: 100%;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2D3748;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #E2E8F0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Montserrat', Arial, sans-serif;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        
        .file-upload {
            border: 2px dashed #E2E8F0;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            border-color: var(--accent);
            background: rgba(74, 144, 226, 0.05);
        }
        
        .file-upload i {
            font-size: 24px;
            color: var(--accent);
            margin-bottom: 10px;
        }
        
        .notification {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 1px solid #4CAF50;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        .notification h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .notification p {
            color: #4CAF50;
            font-size: 14px;
        }
        
        .login-section {
            background: white;
            border-radius: 14px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
        }
        
        .login-title {
            color: #2D3748;
            margin-bottom: 25px;
            font-size: 24px;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .login-message {
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .login-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .login-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .admin-panel {
            background: white;
            border-radius: 14px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .requests-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .requests-table th, .requests-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .requests-table th {
            background: #f9f9f9;
            font-weight: 700;
            color: #2D3748;
        }
        
        .requests-table tr:hover {
            background: #f5f5f5;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background: #d1edff;
            color: #004085;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .photo-modal {
            max-width: 90vw;
            max-height: 90vh;
        }
        
        .photo-modal img {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .photo-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .photo-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 12px;
            color: #4A5568;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: 700;
            color: #2D3748;
        }

        .image-upload-section {
            background: white;
            border-radius: 14px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin-top: 30px;
        }
        
        .image-preview {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .preview-item {
            text-align: center;
        }
        
        .preview-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid #E2E8F0;
        }
        
        .preview-item p {
            font-size: 12px;
            margin-top: 5px;
            color: #4A5568;
        }

        .collections-management {
            background: white;
            border-radius: 14px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin-top: 30px;
        }
        
        .collection-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #E2E8F0;
            border-radius: 10px;
            margin-bottom: 15px;
            background: #fafafa;
        }
        
        .collection-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .collection-info img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .collection-details h4 {
            margin: 0;
            color: #2D3748;
        }
        
        .collection-details p {
            margin: 5px 0 0;
            color: #4A5568;
            font-size: 12px;
        }

        .help-contact {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
        }

        .help-contact h4 {
            margin-bottom: 10px;
        }

        .help-contact a {
            color: white;
            text-decoration: underline;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 900px) {
            .admin-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .admin-controls {
                flex-wrap: wrap;
            }
            .action-buttons {
                flex-direction: column;
            }
            .collection-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
        
        .candy-decoration {
            position: absolute;
            z-index: -1;
            opacity: 0.2;
        }
        
        .candy-decoration-1 {
            top: 15%;
            right: 5%;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, var(--candy-pink), transparent);
            border-radius: 50%;
            filter: blur(2px);
        }
        
        .candy-decoration-2 {
            bottom: 10%;
            left: 5%;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, var(--candy-yellow), transparent);
            border-radius: 50%;
            filter: blur(2px);
        }
        
        .candy-decoration-3 {
            top: 60%;
            left: 3%;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, var(--candy-green), transparent);
            border-radius: 50%;
            filter: blur(2px);
        }
    </style>
</head>
<body>
    <div class="candy-bg candy-1"></div>
    <div class="candy-bg candy-2"></div>
    <div class="candy-bg candy-3"></div>
    <div class="candy-bg candy-4"></div>
    
    <div class="candy-decoration candy-decoration-1"></div>
    <div class="candy-decoration candy-decoration-2"></div>
    <div class="candy-decoration candy-decoration-3"></div>

    <!-- Bot√≥n de Ayuda Flotante -->
    <button class="btn help" onclick="showHelp()">¬øNecesitas Ayuda?</button>

    <header>
        <h1>COLECCIONA Y GANA</h1>
        <p>Completa tu colecci√≥n y gana una figura especial ‚Äî ¬°S√∫bela para revisi√≥n!</p>
    </header>

    <div class="nav-tabs">
        <button class="nav-tab active" data-tab="home">Inicio</button>
        <button class="nav-tab" data-tab="status">Estado de Solicitud</button>
        <button class="nav-tab" data-tab="admin-login">Acceso Admin</button>
        <button class="nav-tab admin-only" data-tab="admin" style="display:none;">Panel de Administraci√≥n</button>
        <button class="nav-tab admin-only" data-tab="collections-management" style="display:none;">Gestionar Colecciones</button>
        <button class="nav-tab admin-only" data-tab="image-config" style="display:none;">Configurar Im√°genes</button>
    </div>

    <div class="container">
        <div id="home" class="tab-content active">
            <section class="hero">
                <div class="hero-card">
                    <div class="badge">GOMITAS</div>
                    <div class="hero-text">
                        <h2>¬°Colecciona, sube y gana!</h2>
                        <p>Sube la foto de tu colecci√≥n completa. Nosotros revisamos y te notificamos por correo.</p>
                    </div>
                </div>
                <div style="min-width:240px; display:flex; gap:8px; align-items:center;">
                    <button id="openForm" class="btn">Subir mi colecci√≥n</button>
                </div>
            </section>

            <section>
                <div class="collections" id="collections-container"></div>
            </section>

            <section id="how-to" style="margin-top:30px;">
                <div style="background:linear-gradient(180deg,#f7fafc,#edf2f7); padding:20px; border-radius:12px; border-left: 4px solid var(--accent);">
                    <h3 style="margin:0 0 10px 0; color:#2D3748">¬øC√≥mo participar?</h3>
                    <ol style="margin:0 0 10px 20px; color:#4A5568; line-height:1.6;">
                        <li>Consigue las 5 piezas de una colecci√≥n.</li>
                        <li>Haz clic en <strong>Colecci√≥n completada</strong> y sube la foto de tu colecci√≥n completa.</li>
                        <li>Ver√°s el mensaje "Se revisar√° su fotograf√≠a y en caso de cumplir con la promoci√≥n se le notificar√° v√≠a correo electr√≥nico".</li>
                        <li>Nosotros revisamos. Si cumples, te avisamos por correo con felicitaciones y la fecha para recoger tu figura.</li>
                    </ol>
                </div>
            </section>
        </div>

        <div id="status" class="tab-content">
            <div class="hero-card" style="max-width: 800px; margin: 0 auto 30px;">
                <div class="badge" style="background: linear-gradient(135deg, #4CAF50, #2E7D32);">ESTADO</div>
                <div class="hero-text">
                    <h2>Consulta el estado de tu solicitud</h2>
                    <p>Ingresa tu correo electr√≥nico para ver el estado de revisi√≥n de tu colecci√≥n.</p>
                </div>
            </div>

            <div class="admin-panel">
                <div class="form-group">
                    <label for="status-email">Correo electr√≥nico</label>
                    <input type="email" id="status-email" placeholder="Ingresa el correo que usaste en tu solicitud">
                </div>
                <button id="check-status" class="btn" style="margin-top: 15px;">Consultar Estado</button>
                <div id="status-results" style="margin-top: 30px;"></div>
            </div>
        </div>

        <div id="admin-login" class="tab-content">
            <div class="login-section">
                <h2 class="login-title">Acceso de Administrador</h2>
                <div class="login-form">
                    <div class="form-group">
                        <label for="admin-username">Usuario</label>
                        <input type="text" id="admin-username" placeholder="Ingresa tu usuario">
                    </div>
                    <div class="form-group">
                        <label for="admin-password">Contrase√±a</label>
                        <input type="password" id="admin-password" placeholder="Ingresa tu contrase√±a">
                    </div>
                    <button id="login-btn" class="btn" style="width:100%;">Iniciar Sesi√≥n</button>
                    <div class="login-message" id="login-message"></div>
                </div>
            </div>
        </div>

        <div id="admin" class="tab-content">
            <div class="admin-panel">
                <div class="admin-header">
                    <h2>Panel de Administraci√≥n</h2>
                    <div class="admin-controls">
                        <button id="refresh-requests" class="btn info">Actualizar</button>
                        <button id="export-data" class="btn secondary">Exportar Datos</button>
                        <button id="logout-admin" class="btn warning">Cerrar Sesi√≥n</button>
                    </div>
                </div>

                <div class="admin-controls">
                    <button class="btn filter-btn active" data-filter="all">Todas</button>
                    <button class="btn filter-btn" data-filter="pending">Pendientes</button>
                    <button class="btn filter-btn" data-filter="approved">Aprobadas</button>
                    <button class="btn filter-btn" data-filter="rejected">Rechazadas</button>
                </div>

                <div id="admin-requests">
                    <p style="text-align: center; padding: 20px; color: #4A5568;">Cargando solicitudes...</p>
                </div>
            </div>
        </div>

        <div id="collections-management" class="tab-content">
            <div class="admin-panel">
                <div class="admin-header">
                    <h2>Gesti√≥n de Colecciones</h2>
                    <button class="btn success" onclick="openAddCollectionModal()">+ Agregar Nueva Colecci√≥n</button>
                </div>

                <div class="collections-management">
                    <h3 style="color: #2D3748; margin-bottom: 20px;">Colecciones Activas</h3>
                    <div id="collections-list"></div>
                </div>
            </div>
        </div>

        <div id="image-config" class="tab-content">
            <div class="admin-panel">
                <h2 style="margin-bottom: 20px;">Configurar Im√°genes de Colecciones</h2>
                <p style="color: #4A5568; margin-bottom: 25px;">Aqu√≠ puedes personalizar las im√°genes de cada colecci√≥n. Puedes usar URLs de internet o subir im√°genes desde tu computadora.</p>
                <div id="image-config-container"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda -->
    <div class="modal-back" id="helpModal">
        <div class="modal">
            <div class="modal-content">
                <h3 style="margin-bottom: 10px; color: #2D3748;">üìû ¬øNecesitas Ayuda?</h3>
                <p style="color: #4A5568; margin-bottom: 20px;">Estamos aqu√≠ para ayudarte con cualquier duda o problema.</p>
                
                <div class="help-contact">
                    <h4>üìß Cont√°ctanos</h4>
                    <p>Si tienes problemas con tu solicitud o necesitas ayuda, escr√≠benos a:</p>
                    <h3><a href="mailto:sdulces016@gmail.com">sdulces016@gmail.com</a></h3>
                    <p style="margin-top: 15px; font-size: 14px;">Te responderemos lo m√°s pronto posible</p>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn secondary" onclick="closeHelpModal()" style="flex: 1;">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para el formulario -->
    <div class="modal-back" id="formModal">
        <div class="modal">
            <div class="modal-content">
                <h3 style="margin-bottom: 10px; color: #2D3748;">Subir mi colecci√≥n</h3>
                <p style="color: #4A5568; margin-bottom: 20px;">Completa el formulario para participar en la promoci√≥n</p>
                <div class="form-container">
                    <form id="collectionForm">
                        <div class="form-group">
                            <label for="name">Nombre completo</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Correo electr√≥nico</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="collection">Figura favorita de la colecci√≥n</label>
                            <select id="collection" name="collection" required>
                                <option value="">Selecciona una figura</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Foto de tu colecci√≥n completa</label>
                            <div class="file-upload" id="fileUpload">
                                <i>üì∑</i>
                                <p>Haz clic para subir tu foto</p>
                                <input type="file" id="photo" name="photo" accept="image/*" style="display:none" required>
                            </div>
                            <div id="fileName" style="margin-top:10px; font-size:12px; color:var(--accent);"></div>
                            <div id="imagePreview" style="margin-top:10px; display:none;">
                                <img id="previewImg" src="" alt="Vista previa" style="max-width:100%; max-height:200px; border-radius:8px;">
                            </div>
                        </div>
                        <button type="submit" class="btn" style="width:100%;">Enviar para revisi√≥n</button>
                    </form>
                    <div class="notification" id="notification" style="display:none;">
                        <h4>‚úÖ Solicitud enviada</h4>
                        <p>Se revisar√° su fotograf√≠a y en caso de cumplir con la promoci√≥n se le notificar√° v√≠a correo electr√≥nico.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-back" id="collectionModal">
        <div class="modal">
            <div class="modal-content">
                <h3 style="margin-bottom: 10px; color: #2D3748;" id="collectionModalTitle">Agregar Nueva Colecci√≥n</h3>
                <p style="color: #4A5568; margin-bottom: 20px;" id="collectionModalSubtitle">Completa la informaci√≥n de la nueva colecci√≥n</p>
                <div class="form-container">
                    <form id="collectionFormModal">
                        <input type="hidden" id="editCollectionId">
                        <div class="form-group">
                            <label for="collectionName">Nombre de la colecci√≥n</label>
                            <input type="text" id="collectionName" name="collectionName" required>
                        </div>
                        <div class="form-group">
                            <label for="collectionDescription">Descripci√≥n</label>
                            <textarea id="collectionDescription" name="collectionDescription" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Imagen de la colecci√≥n</label>
                            <div class="file-upload" id="collectionFileUpload">
                                <i>üñºÔ∏è</i>
                                <p>Haz clic para subir la imagen</p>
                                <input type="file" id="collectionImage" name="collectionImage" accept="image/*" style="display:none">
                            </div>
                            <div id="collectionFileName" style="margin-top:10px; font-size:12px; color:var(--accent);"></div>
                            <div id="collectionImagePreview" style="margin-top:10px; display:none;">
                                <img id="collectionPreviewImg" src="" alt="Vista previa" style="max-width:100%; max-height:200px; border-radius:8px;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn success" style="flex: 1;">Guardar Colecci√≥n</button>
                            <button type="button" class="btn secondary" onclick="closeCollectionModal()" style="flex: 1;">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-back" id="photoModal">
        <div class="modal photo-modal">
            <div class="modal-content">
                <h3 style="margin-bottom: 15px; color: #2D3748;">üì∏ Foto de la Colecci√≥n</h3>
                <div id="photoContainer"></div>
                <div class="photo-info" id="photoInfo"></div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn success" onclick="approveFromModal()" style="flex: 1;">‚úÖ Aprobar</button>
                    <button class="btn warning" onclick="rejectFromModal()" style="flex: 1;">‚ùå Rechazar</button>
                    <button class="btn secondary" onclick="closePhotoModal()" style="flex: 1;">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <footer style="text-align: center; padding: 30px 20px; color: #4A5568; margin-top: 50px;">
        <p>¬© 2024 COLECCIONA Y GANA - Todos los derechos reservados</p>
    </footer>

    <script>
        // Credenciales de administrador
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'colecciona2024'
        };

        // Estado de autenticaci√≥n
        let isAdminAuthenticated = false;

        // Variable para guardar la solicitud actual que se est√° viendo
        let currentSolicitud = null;

        // Base de datos simple usando localStorage
        const DB_KEYS = {
            SOLICITUDES: 'colecciona_solicitudes',
            ADMIN_AUTH: 'colecciona_admin_auth',
            IMAGES: 'colecciona_images',
            COLLECTIONS: 'colecciona_collections'
        };

        // Colecciones por defecto
        const DEFAULT_COLLECTIONS = [
            {
                id: 1,
                name: 'Minecraft',
                description: '5 piezas por colecci√≥n ‚Äî distintas poses o personajes cuentan como distintas.',
                image: 'https://images.unsplash.com/photo-1633436375136-149571d6d46f?w=140&h=140&fit=crop&crop=center'
            },
            {
                id: 2,
                name: 'Stitch',
                description: 'Recopila las 5 y gana una figura especial limitada.',
                image: 'https://images.unsplash.com/photo-1578632749014-ca77efd052eb?w=140&h=140&fit=crop&crop=center'
            },
            {
                id: 3,
                name: 'Memes',
                description: 'Edici√≥n graciosa ‚Äî completa y gana.',
                image: 'https://images.unsplash.com/photo-1611262588024-d12430b98920?w=140&h=140&fit=crop&crop=center'
            },
            {
                id: 4,
                name: 'M√©xico',
                description: 'Tem√°tica mexicana ‚Äî completa la colecci√≥n y reclama tu premio.',
                image: 'https://images.unsplash.com/photo-1518638150340-f706e86654de?w=140&h=140&fit=crop&crop=center'
            }
        ];

        // Funciones para el bot√≥n de ayuda
        function showHelp() {
            document.getElementById('helpModal').style.display = 'flex';
        }

        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // Inicializar datos
        function initData() {
            if (!localStorage.getItem(DB_KEYS.SOLICITUDES)) {
                localStorage.setItem(DB_KEYS.SOLICITUDES, JSON.stringify([]));
            }
            
            if (!localStorage.getItem(DB_KEYS.COLLECTIONS)) {
                localStorage.setItem(DB_KEYS.COLLECTIONS, JSON.stringify(DEFAULT_COLLECTIONS));
            }
            
            if (!localStorage.getItem(DB_KEYS.IMAGES)) {
                // Crear objeto de im√°genes basado en las colecciones
                const defaultImages = {};
                const collections = getCollections();
                collections.forEach(collection => {
                    defaultImages[collection.name.toLowerCase()] = collection.image;
                });
                localStorage.setItem(DB_KEYS.IMAGES, JSON.stringify(defaultImages));
            }
            
            // Cargar datos
            loadCollections();
            loadSavedImages();
            
            // Verificar si ya hay una sesi√≥n activa
            const savedAuth = localStorage.getItem(DB_KEYS.ADMIN_AUTH);
            if (savedAuth === 'true') {
                isAdminAuthenticated = true;
                showAdminPanel();
            }
        }

        // Obtener todas las colecciones
        function getCollections() {
            return JSON.parse(localStorage.getItem(DB_KEYS.COLLECTIONS) || '[]');
        }

        // Guardar colecciones
        function saveCollections(collections) {
            localStorage.setItem(DB_KEYS.COLLECTIONS, JSON.stringify(collections));
        }

        // Cargar colecciones en la p√°gina
        function loadCollections() {
            const collections = getCollections();
            const container = document.getElementById('collections-container');
            const collectionsList = document.getElementById('collections-list');
            const select = document.getElementById('collection');
            
            // Limpiar contenedores
            container.innerHTML = '';
            collectionsList.innerHTML = '';
            if (select) {
                select.innerHTML = '<option value="">Selecciona una figura</option>';
            }
            
            // Cargar en la p√°gina principal
            collections.forEach((collection, index) => {
                // P√°gina principal
                const card = document.createElement('div');
                card.className = 'card';
                card.setAttribute('data-delay', index * 0.1);
                card.innerHTML = `
                    <img src="${collection.image}" alt="${collection.name}">
                    <h3>${collection.name}</h3>
                    <p>${collection.description}</p>
                    <div class="actions">
                        <button class="btn" onclick="openFormFor('${collection.name}')">Colecci√≥n completada</button>
                    </div>
                `;
                container.appendChild(card);
                
                // Lista de administraci√≥n
                const collectionItem = document.createElement('div');
                collectionItem.className = 'collection-item';
                collectionItem.innerHTML = `
                    <div class="collection-info">
                        <img src="${collection.image}" alt="${collection.name}">
                        <div class="collection-details">
                            <h4>${collection.name}</h4>
                            <p>${collection.description}</p>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn info" onclick="editCollection(${collection.id})">‚úèÔ∏è Editar</button>
                        <button class="btn danger" onclick="deleteCollection(${collection.id})">üóëÔ∏è Eliminar</button>
                    </div>
                `;
                collectionsList.appendChild(collectionItem);
                
                // Select del formulario
                if (select) {
                    const option = document.createElement('option');
                    option.value = collection.name;
                    option.textContent = collection.name;
                    select.appendChild(option);
                }
            });
            
            // Animar cards
            setTimeout(() => {
                document.querySelectorAll('.card').forEach(card => {
                    card.classList.add('loaded');
                });
            }, 100);
        }

        // Cargar configuraci√≥n de im√°genes
        function loadImageConfig() {
            const container = document.getElementById('image-config-container');
            const collections = getCollections();
            const savedImages = JSON.parse(localStorage.getItem(DB_KEYS.IMAGES) || '{}');
            
            container.innerHTML = '';
            
            collections.forEach(collection => {
                const collectionKey = collection.name.toLowerCase();
                const section = document.createElement('div');
                section.className = 'image-upload-section';
                section.innerHTML = `
                    <h3 style="color: #2D3748; margin-bottom: 20px;">${collection.name}</h3>
                    <div class="form-group">
                        <label for="${collectionKey}-url">URL de imagen para ${collection.name}:</label>
                        <input type="text" id="${collectionKey}-url" placeholder="https://ejemplo.com/imagen.jpg" value="${savedImages[collectionKey] || ''}">
                        <button class="btn" onclick="updateImage('${collectionKey}')" style="margin-top: 10px;">Actualizar Imagen</button>
                    </div>
                    <div class="form-group">
                        <label>O subir desde tu computadora:</label>
                        <input type="file" id="${collectionKey}-file" accept="image/*" style="margin-top: 5px;">
                        <button class="btn" onclick="uploadImage('${collectionKey}')" style="margin-top: 10px;">Subir Imagen</button>
                    </div>
                    <div class="image-preview">
                        <div class="preview-item">
                            <img id="${collectionKey}-preview" src="${savedImages[collectionKey] || collection.image}" alt="${collection.name} Preview">
                            <p>Vista previa</p>
                        </div>
                    </div>
                `;
                container.appendChild(section);
            });
        }

        // Cargar im√°genes guardadas
        function loadSavedImages() {
            const savedImages = JSON.parse(localStorage.getItem(DB_KEYS.IMAGES) || '{}');
            const collections = getCollections();
            
            collections.forEach(collection => {
                const collectionKey = collection.name.toLowerCase();
                if (savedImages[collectionKey]) {
                    // Actualizar im√°genes en las cards
                    const cards = document.querySelectorAll('.card');
                    cards.forEach(card => {
                        const h3 = card.querySelector('h3');
                        if (h3 && h3.textContent === collection.name) {
                            const img = card.querySelector('img');
                            if (img) img.src = savedImages[collectionKey];
                        }
                    });
                    
                    // Actualizar previews en configuraci√≥n
                    const preview = document.getElementById(`${collectionKey}-preview`);
                    if (preview) preview.src = savedImages[collectionKey];
                }
            });
        }

        // Obtener todas las solicitudes
        function getSolicitudes() {
            return JSON.parse(localStorage.getItem(DB_KEYS.SOLICITUDES) || '[]');
        }

        // Guardar solicitud
        function saveSolicitud(solicitud) {
            const solicitudes = getSolicitudes();
            const newId = solicitudes.length > 0 ? Math.max(...solicitudes.map(s => s.id)) + 1 : 1;
            
            // Convertir la imagen a base64 para almacenarla
            const photoFile = document.getElementById('photo').files[0];
            const reader = new FileReader();
            
            return new Promise((resolve, reject) => {
                reader.onload = function() {
                    const nuevaSolicitud = {
                        id: newId,
                        ...solicitud,
                        fotoData: reader.result, // Guardar la imagen como base64
                        fecha: new Date().toISOString(),
                        status: 'pending',
                        revisadoPor: '',
                        fechaRevision: '',
                        fechaRecogida: '',
                        mensajeAdmin: ''
                    };
                    
                    solicitudes.push(nuevaSolicitud);
                    localStorage.setItem(DB_KEYS.SOLICITUDES, JSON.stringify(solicitudes));
                    resolve(newId);
                };
                
                reader.onerror = () => reject(reader.error);
                
                if (photoFile) {
                    reader.readAsDataURL(photoFile);
                } else {
                    reject(new Error('No se ha seleccionado ninguna foto'));
                }
            });
        }

        // Actualizar solicitud
        function updateSolicitud(id, updates) {
            const solicitudes = getSolicitudes();
            const index = solicitudes.findIndex(s => s.id === id);
            
            if (index !== -1) {
                solicitudes[index] = { ...solicitudes[index], ...updates };
                localStorage.setItem(DB_KEYS.SOLICITUDES, JSON.stringify(solicitudes));
                return true;
            }
            return false;
        }

        // Obtener solicitudes por estado
        function getSolicitudesByStatus(status) {
            const solicitudes = getSolicitudes();
            if (status === 'all') return solicitudes;
            return solicitudes.filter(s => s.status === status);
        }

        // Obtener solicitud por email
        function getSolicitudByEmail(email) {
            const solicitudes = getSolicitudes();
            return solicitudes.filter(s => s.email === email);
        }

        // Verificar credenciales
        function verifyAdminCredentials(username, password) {
            return username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password;
        }

        // Mostrar panel de administraci√≥n
        function showAdminPanel() {
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'block';
            });
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('.admin-only').classList.add('active');
            document.getElementById('admin').classList.add('active');
            loadAdminRequests();
            loadImageConfig();
        }

        // Cerrar sesi√≥n
        function logoutAdmin() {
            isAdminAuthenticated = false;
            localStorage.removeItem(DB_KEYS.ADMIN_AUTH);
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });
            
            // Cambiar a la pesta√±a de inicio
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-tab="home"]').classList.add('active');
            document.getElementById('home').classList.add('active');
            
            showLoginMessage('Sesi√≥n cerrada correctamente', 'success');
        }

        // Mostrar mensaje de login
        function showLoginMessage(message, type) {
            const messageDiv = document.getElementById('login-message');
            messageDiv.textContent = message;
            messageDiv.className = `login-message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // Abrir modal para agregar colecci√≥n
        function openAddCollectionModal() {
            document.getElementById('collectionModalTitle').textContent = 'Agregar Nueva Colecci√≥n';
            document.getElementById('collectionModalSubtitle').textContent = 'Completa la informaci√≥n de la nueva colecci√≥n';
            document.getElementById('editCollectionId').value = '';
            document.getElementById('collectionName').value = '';
            document.getElementById('collectionDescription').value = '';
            document.getElementById('collectionFileName').textContent = '';
            document.getElementById('collectionImagePreview').style.display = 'none';
            document.getElementById('collectionImage').value = '';
            document.getElementById('collectionModal').style.display = 'flex';
        }

        // Cerrar modal de colecci√≥n
        function closeCollectionModal() {
            document.getElementById('collectionModal').style.display = 'none';
        }

        // Editar colecci√≥n
        function editCollection(id) {
            const collections = getCollections();
            const collection = collections.find(c => c.id === id);
            
            if (collection) {
                document.getElementById('collectionModalTitle').textContent = 'Editar Colecci√≥n';
                document.getElementById('collectionModalSubtitle').textContent = 'Modifica la informaci√≥n de la colecci√≥n';
                document.getElementById('editCollectionId').value = collection.id;
                document.getElementById('collectionName').value = collection.name;
                document.getElementById('collectionDescription').value = collection.description;
                document.getElementById('collectionFileName').textContent = 'Imagen actual cargada';
                document.getElementById('collectionImagePreview').style.display = 'block';
                document.getElementById('collectionPreviewImg').src = collection.image;
                document.getElementById('collectionModal').style.display = 'flex';
            }
        }

        // Eliminar colecci√≥n
        function deleteCollection(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta colecci√≥n? Esta acci√≥n no se puede deshacer.')) {
                const collections = getCollections();
                const updatedCollections = collections.filter(c => c.id !== id);
                saveCollections(updatedCollections);
                loadCollections();
                loadImageConfig();
                alert('Colecci√≥n eliminada correctamente');
            }
        }

        // Guardar colecci√≥n desde el modal
        document.getElementById('collectionFormModal').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const collections = getCollections();
            const editId = document.getElementById('editCollectionId').value;
            const name = document.getElementById('collectionName').value;
            const description = document.getElementById('collectionDescription').value;
            const imageFile = document.getElementById('collectionImage').files[0];
            
            if (editId) {
                // Editar colecci√≥n existente
                const index = collections.findIndex(c => c.id == editId);
                if (index !== -1) {
                    if (imageFile) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            collections[index] = {
                                ...collections[index],
                                name: name,
                                description: description,
                                image: e.target.result
                            };
                            saveCollections(collections);
                            loadCollections();
                            loadImageConfig();
                            closeCollectionModal();
                            alert('Colecci√≥n actualizada correctamente');
                        };
                        reader.readAsDataURL(imageFile);
                    } else {
                        collections[index] = {
                            ...collections[index],
                            name: name,
                            description: description
                        };
                        saveCollections(collections);
                        loadCollections();
                        loadImageConfig();
                        closeCollectionModal();
                        alert('Colecci√≥n actualizada correctamente');
                    }
                }
            } else {
                // Agregar nueva colecci√≥n
                const newId = collections.length > 0 ? Math.max(...collections.map(c => c.id)) + 1 : 1;
                const defaultImage = 'https://images.unsplash.com/photo-1611262588024-d12430b98920?w=140&h=140&fit=crop&crop=center';
                
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const newCollection = {
                            id: newId,
                            name: name,
                            description: description,
                            image: e.target.result
                        };
                        collections.push(newCollection);
                        saveCollections(collections);
                        loadCollections();
                        loadImageConfig();
                        closeCollectionModal();
                        alert('Colecci√≥n agregada correctamente');
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    const newCollection = {
                        id: newId,
                        name: name,
                        description: description,
                        image: defaultImage
                    };
                    collections.push(newCollection);
                    saveCollections(collections);
                    loadCollections();
                    loadImageConfig();
                    closeCollectionModal();
                    alert('Colecci√≥n agregada correctamente');
                }
            }
        });

        // Actualizar imagen desde URL
        function updateImage(collectionKey) {
            const urlInput = document.getElementById(`${collectionKey}-url`);
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('Por favor ingresa una URL v√°lida');
                return;
            }
            
            // Guardar la imagen
            const savedImages = JSON.parse(localStorage.getItem(DB_KEYS.IMAGES) || '{}');
            savedImages[collectionKey] = url;
            localStorage.setItem(DB_KEYS.IMAGES, JSON.stringify(savedImages));
            
            // Actualizar la vista
            loadSavedImages();
            
            // Limpiar el campo
            urlInput.value = '';
            
            alert('¬°Imagen actualizada correctamente!');
        }

        // Subir imagen desde archivo
        function uploadImage(collectionKey) {
            const fileInput = document.getElementById(`${collectionKey}-file`);
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Por favor selecciona un archivo');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona un archivo de imagen v√°lido');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Guardar la imagen como data URL
                const savedImages = JSON.parse(localStorage.getItem(DB_KEYS.IMAGES) || '{}');
                savedImages[collectionKey] = e.target.result;
                localStorage.setItem(DB_KEYS.IMAGES, JSON.stringify(savedImages));
                
                // Actualizar la vista
                loadSavedImages();
                
                // Limpiar el campo
                fileInput.value = '';
                
                alert('¬°Imagen subida correctamente!');
            };
            reader.readAsDataURL(file);
        }

        // Mostrar foto del cliente en modal
        function showClientPhoto(solicitud) {
            currentSolicitud = solicitud;
            
            const photoContainer = document.getElementById('photoContainer');
            const photoInfo = document.getElementById('photoInfo');
            
            photoContainer.innerHTML = '';
            photoInfo.innerHTML = '';
            
            if (solicitud.fotoData) {
                const img = document.createElement('img');
                img.src = solicitud.fotoData;
                img.alt = `Colecci√≥n de ${solicitud.name}`;
                photoContainer.appendChild(img);
                
                const fecha = new Date(solicitud.fecha).toLocaleDateString('es-ES');
                
                photoInfo.innerHTML = `
                    <h4 style="color: #2D3748; margin-bottom: 15px;">Informaci√≥n de la Solicitud</h4>
                    <div class="photo-details">
                        <div class="detail-item">
                            <span class="detail-label">ID de Solicitud</span>
                            <span class="detail-value">#${solicitud.id}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Nombre</span>
                            <span class="detail-value">${solicitud.name}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Email</span>
                            <span class="detail-value">${solicitud.email}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Colecci√≥n</span>
                            <span class="detail-value">${solicitud.collection}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Fecha de solicitud</span>
                            <span class="detail-value">${fecha}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Estado</span>
                            <span class="detail-value status-${solicitud.status}">${solicitud.status === 'pending' ? 'Pendiente' : solicitud.status}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('photoModal').style.display = 'flex';
            } else {
                alert('No hay foto disponible para esta solicitud');
            }
        }

        // Cerrar modal de foto
        function closePhotoModal() {
            document.getElementById('photoModal').style.display = 'none';
            currentSolicitud = null;
        }

        // Aprobar desde el modal - CORREGIDO
        function approveFromModal() {
            if (!currentSolicitud) return;
            
            const fechaRecogida = prompt('Ingresa la fecha para recoger la figura (YYYY-MM-DD):');
            if (!fechaRecogida) return;
            
            const success = updateSolicitud(currentSolicitud.id, {
                status: 'approved',
                fechaRevision: new Date().toISOString(),
                revisadoPor: 'Administrador',
                fechaRecogida: fechaRecogida,
                mensajeAdmin: '¬°Felicidades! Tu colecci√≥n ha sido aprobada. Puedes recoger tu figura especial en la fecha indicada.'
            });
            
            if (success) {
                alert('Solicitud aprobada exitosamente');
                closePhotoModal();
                loadAdminRequests();
            } else {
                alert('Error al aprobar la solicitud');
            }
        }

        // Rechazar desde el modal - CORREGIDO
        function rejectFromModal() {
            if (!currentSolicitud) return;
            
            const motivo = prompt('Ingresa el motivo del rechazo:');
            if (motivo === null) return;
            
            // AQU√ç EST√Å LA CORRECCI√ìN - ahora s√≠ guarda el mensaje
            const success = updateSolicitud(currentSolicitud.id, {
                status: 'rejected',
                fechaRevision: new Date().toISOString(),
                revisadoPor: 'Administrador',
                mensajeAdmin: motivo || 'Lo sentimos, tu colecci√≥n no cumple con los requisitos de la promoci√≥n.'
            });
            
            if (success) {
                alert('Solicitud rechazada exitosamente. El cliente ver√° el motivo cuando consulte su estado.');
                closePhotoModal();
                loadAdminRequests();
            } else {
                alert('Error al rechazar la solicitud');
            }
        }

        // Cargar solicitudes en el panel de administraci√≥n
        function loadAdminRequests(filter = 'all') {
            if (!isAdminAuthenticated) return;
            
            const solicitudes = getSolicitudesByStatus(filter);
            const container = document.getElementById('admin-requests');
            
            if (solicitudes.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px; color: #4A5568;">No hay solicitudes ' + 
                                     (filter === 'all' ? '' : filter) + '.</p>';
                return;
            }
            
            let html = `
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Colecci√≥n</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            solicitudes.forEach(solicitud => {
                const fecha = new Date(solicitud.fecha).toLocaleDateString('es-ES');
                const statusClass = `status-${solicitud.status}`;
                const statusText = {
                    'pending': 'Pendiente',
                    'approved': 'Aprobada',
                    'rejected': 'Rechazada',
                    'completed': 'Completada'
                }[solicitud.status] || solicitud.status;
                
                html += `
                    <tr>
                        <td>${solicitud.id}</td>
                        <td>${solicitud.name}</td>
                        <td>${solicitud.email}</td>
                        <td>${solicitud.collection}</td>
                        <td>${fecha}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td class="action-buttons">
                `;
                
                // Bot√≥n para ver foto (siempre disponible)
                html += `<button class="btn info" onclick="showClientPhoto(${JSON.stringify(solicitud).replace(/"/g, '&quot;')})">üì∏ Ver Foto</button>`;
                
                if (solicitud.status === 'pending') {
                    html += `
                        <button class="btn success" onclick="approveRequest(${solicitud.id})">Aprobar</button>
                        <button class="btn warning" onclick="rejectRequest(${solicitud.id})">Rechazar</button>
                    `;
                } else if (solicitud.status === 'approved') {
                    html += `
                        <button class="btn info" onclick="markCompleted(${solicitud.id})">Marcar Recogido</button>
                    `;
                } else {
                    html += `<span style="color: #4A5568; font-size: 12px;">No hay acciones</span>`;
                }
                
                html += `</td></tr>`;
            });
            
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        // Mostrar resultados de estado - MEJORADO para mostrar mensajes
        function displayStatusResults(solicitudes) {
            const container = document.getElementById('status-results');
            
            if (solicitudes.length === 0) {
                container.innerHTML = `
                    <div class="status-card">
                        <div class="status-header">
                            <h3>No se encontraron solicitudes</h3>
                        </div>
                        <p>No hay solicitudes asociadas a este correo electr√≥nico.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            solicitudes.forEach(solicitud => {
                const fecha = new Date(solicitud.fecha).toLocaleDateString('es-ES');
                const statusClass = `status-${solicitud.status}`;
                const statusText = {
                    'pending': 'Pendiente de revisi√≥n',
                    'approved': 'Aprobada',
                    'rejected': 'Rechazada',
                    'completed': 'Completada'
                }[solicitud.status] || solicitud.status;
                
                html += `
                    <div class="status-card">
                        <div class="status-header">
                            <h3>Solicitud #${solicitud.id} - ${solicitud.collection}</h3>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        
                        <div class="status-details">
                            <div class="detail-item">
                                <span class="detail-label">Nombre</span>
                                <span class="detail-value">${solicitud.name}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Email</span>
                                <span class="detail-value">${solicitud.email}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Colecci√≥n</span>
                                <span class="detail-value">${solicitud.collection}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Fecha de solicitud</span>
                                <span class="detail-value">${fecha}</span>
                            </div>
                        </div>
                `;
                
                if (solicitud.status === 'pending') {
                    html += `
                        <div class="notification">
                            <h4>‚è≥ En revisi√≥n</h4>
                            <p>Se revisar√° su fotograf√≠a y en caso de cumplir con la promoci√≥n se le notificar√° v√≠a correo electr√≥nico.</p>
                        </div>
                    `;
                } else if (solicitud.status === 'approved') {
                    const fechaRecogida = solicitud.fechaRecogida ? 
                        new Date(solicitud.fechaRecogida).toLocaleDateString('es-ES') : 'Por definir';
                    
                    html += `
                        <div class="approved-message">
                            <h3>¬°Felicidades!</h3>
                            <p>${solicitud.mensajeAdmin || 'Tu solicitud ha sido aprobada. Puedes recoger tu figura especial.'}</p>
                            <div class="pickup-date">Fecha de recogida: ${fechaRecogida}</div>
                        </div>
                    `;
                } else if (solicitud.status === 'rejected') {
                    html += `
                        <div class="rejected-message" style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <h4>‚ùå Solicitud Rechazada</h4>
                            <p><strong>Motivo:</strong> ${solicitud.mensajeAdmin || 'Lo sentimos, tu colecci√≥n no cumple con los requisitos de la promoci√≥n.'}</p>
                            <p style="margin-top: 10px; font-size: 14px;">Si tienes dudas, cont√°ctanos usando el bot√≥n de ayuda.</p>
                        </div>
                    `;
                }
                
                html += `</div>`;
            });
            
            container.innerHTML = html;
        }

        // Funciones globales para los botones de acci√≥n - CORREGIDAS
        function approveRequest(id) {
            const fechaRecogida = prompt('Ingresa la fecha para recoger la figura (YYYY-MM-DD):');
            if (!fechaRecogida) return;
            
            const success = updateSolicitud(id, {
                status: 'approved',
                fechaRevision: new Date().toISOString(),
                revisadoPor: 'Administrador',
                fechaRecogida: fechaRecogida,
                mensajeAdmin: '¬°Felicidades! Tu colecci√≥n ha sido aprobada. Puedes recoger tu figura especial en la fecha indicada.'
            });
            
            if (success) {
                alert('Solicitud aprobada exitosamente');
                loadAdminRequests();
            } else {
                alert('Error al aprobar la solicitud');
            }
        }
        
        function rejectRequest(id) {
            const motivo = prompt('Ingresa el motivo del rechazo:');
            if (motivo === null) return;
            
            const success = updateSolicitud(id, {
                status: 'rejected',
                fechaRevision: new Date().toISOString(),
                revisadoPor: 'Administrador',
                mensajeAdmin: motivo || 'Lo sentimos, tu colecci√≥n no cumple con los requisitos de la promoci√≥n.'
            });
            
            if (success) {
                alert('Solicitud rechazada exitosamente. El cliente ver√° el motivo cuando consulte su estado.');
                loadAdminRequests();
            } else {
                alert('Error al rechazar la solicitud');
            }
        }
        
        function markCompleted(id) {
            const success = updateSolicitud(id, {
                status: 'completed'
            });
            
            if (success) {
                alert('Solicitud marcada como completada');
                loadAdminRequests();
            } else {
                alert('Error al marcar la solicitud como completada');
            }
        }

        // Funciones para el formulario modal
        function openFormFor(collection) {
            document.getElementById('collection').value = collection;
            document.getElementById('formModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('formModal').style.display = 'none';
            document.getElementById('collectionForm').reset();
            document.getElementById('notification').style.display = 'none';
            document.getElementById('fileName').textContent = '';
            document.getElementById('imagePreview').style.display = 'none';
        }

        // DOM y Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar datos
            initData();
            
            // Navegaci√≥n entre pesta√±as
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover clase active de todas las pesta√±as y contenidos
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Activar pesta√±a clickeada
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Cargar configuraci√≥n de im√°genes si es necesario
                    if (tabId === 'image-config') {
                        loadImageConfig();
                    }
                });
            });
            
            // Bot√≥n para abrir formulario general
            document.getElementById('openForm').addEventListener('click', function() {
                openFormFor('');
            });
            
            // Manejar la subida de archivos del formulario principal
            document.getElementById('fileUpload').addEventListener('click', function() {
                document.getElementById('photo').click();
            });
            
            document.getElementById('photo').addEventListener('change', function() {
                const file = this.files[0];
                const fileName = file ? file.name : 'Ning√∫n archivo seleccionado';
                document.getElementById('fileName').textContent = fileName;
                
                // Mostrar vista previa de la imagen
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('previewImg').src = e.target.result;
                        document.getElementById('imagePreview').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    document.getElementById('imagePreview').style.display = 'none';
                }
            });
            
            // Manejar la subida de archivos del modal de colecciones
            document.getElementById('collectionFileUpload').addEventListener('click', function() {
                document.getElementById('collectionImage').click();
            });
            
            document.getElementById('collectionImage').addEventListener('change', function() {
                const file = this.files[0];
                const fileName = file ? file.name : 'Ning√∫n archivo seleccionado';
                document.getElementById('collectionFileName').textContent = fileName;
                
                // Mostrar vista previa de la imagen
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('collectionPreviewImg').src = e.target.result;
                        document.getElementById('collectionImagePreview').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    document.getElementById('collectionImagePreview').style.display = 'none';
                }
            });
            
            // Manejar el env√≠o del formulario principal
            document.getElementById('collectionForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    collection: document.getElementById('collection').value
                };
                
                try {
                    // Guardar en la base de datos
                    const id = await saveSolicitud(formData);
                    console.log('Solicitud guardada con ID:', id);
                    
                    // Ocultar formulario y mostrar notificaci√≥n
                    document.getElementById('collectionForm').style.display = 'none';
                    document.getElementById('notification').style.display = 'block';
                    
                    // Cerrar el modal despu√©s de 3 segundos
                    setTimeout(function() {
                        closeModal();
                        document.getElementById('collectionForm').style.display = 'block';
                    }, 3000);
                } catch (error) {
                    console.error('Error al guardar la solicitud:', error);
                    alert('Error al enviar la solicitud. Intenta nuevamente.');
                }
            });
            
            // Login de administrador
            document.getElementById('login-btn').addEventListener('click', function() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                
                if (!username || !password) {
                    showLoginMessage('Por favor ingresa usuario y contrase√±a', 'error');
                    return;
                }
                
                if (verifyAdminCredentials(username, password)) {
                    isAdminAuthenticated = true;
                    localStorage.setItem(DB_KEYS.ADMIN_AUTH, 'true');
                    showAdminPanel();
                    showLoginMessage('¬°Inicio de sesi√≥n exitoso!', 'success');
                } else {
                    showLoginMessage('Credenciales incorrectas', 'error');
                }
            });
            
            // Cerrar sesi√≥n de administrador
            document.getElementById('logout-admin').addEventListener('click', logoutAdmin);
            
            // Filtros en el panel de administraci√≥n
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const filter = this.getAttribute('data-filter');
                    loadAdminRequests(filter);
                });
            });
            
            // Actualizar solicitudes
            document.getElementById('refresh-requests').addEventListener('click', function() {
                const activeFilter = document.querySelector('.filter-btn.active').getAttribute('data-filter');
                loadAdminRequests(activeFilter);
            });
            
            // Consultar estado
            document.getElementById('check-status').addEventListener('click', function() {
                const email = document.getElementById('status-email').value;
                if (!email) {
                    alert('Por favor ingresa tu correo electr√≥nico');
                    return;
                }
                
                const solicitudes = getSolicitudByEmail(email);
                displayStatusResults(solicitudes);
            });
            
            // Cerrar modales al hacer clic fuera
            document.querySelectorAll('.modal-back').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if(e.target === this) {
                        if (this.id === 'formModal') closeModal();
                        if (this.id === 'photoModal') closePhotoModal();
                        if (this.id === 'collectionModal') closeCollectionModal();
                        if (this.id === 'helpModal') closeHelpModal();
                    }
                });
            });
        });
    </script>
</body>
</html>
